<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DocOps Web Console</title>
    <link rel="stylesheet" href="/web/static/web_console.css" />
  </head>
  <body>
    <h1>DocOps Web Console</h1>
    <p class="hint">
      Debug/demo UI for <code>/v1/run</code>. Keep this endpoint protected in production.
    </p>

    <section>
      <h2>A. Server Info</h2>
      <div class="grid-cols">
        <label>
          API Base URL (empty = same-origin)
          <input id="api-base-url" type="text" placeholder="http://127.0.0.1:8000" />
        </label>
        <div class="inline align-end">
          <button id="load-meta-btn" type="button">Load Meta</button>
          <a id="meta-link" href="/v1/meta" target="_blank" rel="noopener">Open /v1/meta</a>
        </div>
      </div>
      <div id="meta-status" class="hint">Meta not loaded.</div>
      <div id="meta-warning" class="warn"></div>
    </section>

    <section>
      <h2>B. Inputs</h2>
      <form id="run-form" class="grid">
        <div class="grid-cols">
          <label>
            Skill (from meta)
            <select id="skill-select">
              <option value="meeting_notice">meeting_notice</option>
            </select>
          </label>
          <label>
            Skill (manual fallback)
            <input id="skill-input" type="text" value="meeting_notice" />
          </label>
          <label>
            Task Type (from meta)
            <select id="task-type-select">
              <option value="">(from task JSON)</option>
              <option value="meeting_notice">meeting_notice</option>
            </select>
          </label>
          <label>
            Preset
            <select id="preset-select">
              <option value="quick">quick</option>
              <option value="template">template</option>
              <option value="strict">strict</option>
            </select>
          </label>
        </div>

        <div class="grid-cols">
          <label>
            Template (.docx)
            <input id="template-file" type="file" accept=".docx" required />
          </label>
          <label>
            <span>Strict mode (independent flag)</span>
            <input id="strict" type="checkbox" />
          </label>
          <label>
            <span>Export suggested policy</span>
            <input id="export-suggested-policy" type="checkbox" />
          </label>
        </div>

        <label>
          Task JSON
          <textarea id="task-json" required>{"task_type":"meeting_notice","payload":{"meeting_title":"Weekly meeting"}}</textarea>
        </label>
        <div class="inline">
          <label class="file-label">
            Import task.json
            <input id="import-task-file" type="file" accept=".json,application/json" />
          </label>
          <button id="export-task-btn" type="button">Export task.json</button>
          <span class="hint">Template file will not be remembered by browser storage.</span>
        </div>

        <label>
          policy_yaml (optional text)
          <textarea id="policy-yaml" placeholder="Leave empty to use default policy"></textarea>
        </label>
      </form>
    </section>

    <section>
      <h2>C. Run</h2>
      <div class="inline">
        <button id="run-btn" type="button">Run</button>
        <span id="run-state" class="hint">Idle</span>
      </div>
    </section>

    <section>
      <h2>D. Result</h2>
      <div id="result-metrics">
        <div>HTTP Status: <strong id="result-status">-</strong></div>
        <div class="inline">
          <span>Request ID:</span>
          <input id="result-request-id" class="request-id-input" type="text" readonly value="" />
          <button id="copy-request-id" type="button">Copy</button>
        </div>
        <div>Duration (ms): <strong id="result-duration">-</strong></div>
        <div>Exit Code: <strong id="result-exit-code">-</strong></div>
      </div>

      <div id="success-area" class="hidden">
        <p class="ok">Run succeeded.</p>
        <a id="download-link" href="#" download="docops_outputs.zip">Download ZIP</a>
      </div>

      <div id="error-area" class="hidden">
        <p class="err">Run failed.</p>
        <pre id="error-lines"></pre>
        <pre id="error-json"></pre>
      </div>

      <div id="reproduce-area">
        <h3>Reproduce (curl)</h3>
        <div class="inline">
          <button id="copy-curl-btn" type="button">Copy curl</button>
        </div>
        <pre id="reproduce-curl"></pre>
      </div>
    </section>

    <section>
      <h2>E. Recent History</h2>
      <ul id="history-list" class="history-list"></ul>
    </section>

    <script src="/web/static/web_console.js"></script>
  </body>
</html>
